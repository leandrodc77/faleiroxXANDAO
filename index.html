<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Duelo das Sinapses ‚Äî Atari-like</title>
  <style>
    :root{
      --bg:#0b0f14; --fg:#e5f2ff; --accent:#7ee787; --accent2:#ff9e64; --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%;}
    body{
      margin:0; background:radial-gradient(1200px 600px at 50% -20%, #13202e 0%, #0b0f14 60%, #070a0f 100%);
      color:var(--fg); font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Noto Color Emoji","Segoe UI Emoji";
      display:flex; align-items:center; justify-content:center;
    }
    .frame{width: min(100vw, 920px);}
    header{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:12px 8px;}
    h1{font-size:clamp(18px,3vw,26px); margin:0; letter-spacing:0.5px}
    .btn{border:1px solid #274157; background:#0e1620; color:var(--fg); padding:8px 12px; border-radius:12px; cursor:pointer; font-weight:600}
    .btn:hover{background:#132335}
    .panel{display:grid; grid-template-columns: 1fr; gap:10px;}
    canvas{width:100%; height:auto; background: #000; border-radius:16px; box-shadow:0 8px 30px rgba(0,0,0,.45), inset 0 0 0 2px #1b2836}
    .hud{display:flex; gap:12px; flex-wrap:wrap; align-items:center; justify-content:space-between; padding:10px 2px; font-size:14px}
    .hud .pill{background:#0e1620; border:1px solid #274157; padding:6px 10px; border-radius:999px}
    .row{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .kbd{background:#0d1520;border:1px solid #22364b; padding:2px 6px; border-radius:6px; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .muted{opacity:.8}
    footer{opacity:.7; font-size:12px; text-align:center; padding:6px}
    .overlay{position:absolute; inset:0; display:flex; align-items:center; justify-content:center;}
    .card{max-width:720px; width:90%; background:#0b1521; border:1px solid #274157; border-radius:18px; padding:18px; box-shadow:0 10px 40px rgba(0,0,0,.45)}
    .card h2{margin:0 0 10px 0}
    .choices{display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-top:12px}
    .choice{border:1px solid #274157; background:#0e1a27; padding:12px; border-radius:14px; cursor:pointer}
    .choice:hover{background:#122236}
    .choice h3{margin:0 0 4px; font-size:16px}
    .choice p{margin:0; font-size:13px; opacity:.9}
    .crt::after{content:""; position:absolute; inset:0; background: repeating-linear-gradient(transparent, transparent 2px, rgba(255,255,255,.04) 3px); pointer-events:none; border-radius:16px}
  </style>
</head>
<body>
  <div class="frame">
    <header>
      <h1>üïπÔ∏è Duelo das Sinapses ‚Äî estilo Atari</h1>
      <div class="row">
        <button id="btnReset" class="btn">Reiniciar</button>
        <button id="btnMute" class="btn" aria-pressed="false">üîä Som</button>
      </div>
    </header>

    <div class="panel">
      <div style="position:relative">
        <canvas id="game" width="900" height="600" class="crt"></canvas>
        <div id="startOverlay" class="overlay">
          <div class="card">
            <h2>Escolha seu personagem</h2>
            <p class="muted">Setas / A D para mover ‚Ä¢ <span class="kbd">Espa√ßo</span> atira ‚Ä¢ <span class="kbd">P</span> pausa.</p>
            <div class="choices">
              <div class="choice" data-hero="faleiro">
                <h3>üß† Prof. Faleiro Neuro</h3>
                <p>Usa rosto em <code>assets/faleiro-face.png</code>.</p>
              </div>
              <div class="choice" data-hero="xadao">
                <h3>üíâ Dr. Xad√£o Pediatr√£o</h3>
                <p>Dispara inje√ß√µes supers√¥nicas.</p>
              </div>
            </div>
          </div>
        </div>
        <div id="pauseOverlay" class="overlay" style="display:none">
          <div class="card"><h2>‚è∏Ô∏è Pausado</h2><p class="muted">Pressione <span class="kbd">P</span> para continuar.</p></div>
        </div>
        <div id="gameOverOverlay" class="overlay" style="display:none">
          <div class="card"><h2>üíÄ Fim de Jogo</h2>
            <p id="finalScore">Pontua√ß√£o: 0</p>
            <div class="row"><button id="btnAgain" class="btn">Jogar novamente</button></div>
          </div>
        </div>
      </div>
      
      <div class="hud">
        <div class="row">
          <span class="pill" id="hudHero">Her√≥i: ‚Äî</span>
          <span class="pill">Vidas: <strong id="hudLives">3</strong></span>
          <span class="pill">Pontos: <strong id="hudScore">0</strong></span>
          <span class="pill">N√≠vel: <strong id="hudLevel">1</strong></span>
        </div>
        <div class="row muted">Controles: <span class="kbd">‚Üê</span> <span class="kbd">‚Üí</span> ou <span class="kbd">A</span> <span class="kbd">D</span> ‚Ä¢ <span class="kbd">Espa√ßo</span> atirar ‚Ä¢ <span class="kbd">P</span> pausar</div>
      </div>
    </div>

    <footer>¬© 2025 ‚Äî Brincadeira l√∫dica estilo retr√¥. Som via WebAudio.</footer>
  </div>

  <script>
  // ===== Utilidades =====
  const rand = (a,b)=>Math.random()*(b-a)+a;
  const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));

  // ===== √Åudio =====
  const AudioSys = (()=>{
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    let muted=false;
    function beep(freq=440, time=0.08, type='square', gain=0.02){
      if(muted) return;
      const o=ctx.createOscillator(); const g=ctx.createGain();
      o.type=type; o.frequency.value=freq; g.gain.value=gain;
      o.connect(g); g.connect(ctx.destination);
      o.start(); o.stop(ctx.currentTime + time);
    }
    return { ctx, beep, toggle(){muted=!muted; return muted;}, get muted(){return muted;} };
  })();

  // ===== Canvas =====
  const canvas = document.getElementById('game');
  const c = canvas.getContext('2d');

  // ===== Face do Faleiro carregada de /assets =====
  const FALEIRO_FACE = new Image();
  let faceLoaded = false;
  FALEIRO_FACE.onload = ()=> faceLoaded = true;
  FALEIRO_FACE.onerror = ()=> console.warn('Falha ao carregar assets/faleiro-face.png');
  FALEIRO_FACE.src = 'assets/faleiro-face.png'; // <- mantenha este caminho no GitHub

  const state = {
    running:false, paused:false, over:false,
    hero:null, heroName:'‚Äî',
    score:0, level:1, lives:3,
    keys:{left:false,right:false,fire:false},
    bullets:[], enemies:[], particles:[], enemyBullets:[],
    lastSpawn:0, spawnInterval:1400,
    lastShot:0, shotInterval:220
  };

  const HEROES = {
    faleiro:{ name:'Faleiro Neuro', color:'#7ee787', shotColor:'#aaf0a5',
      draw:(x,y)=>{ // cabe√ßa com rosto real + jaleco
        c.save();
        c.beginPath(); c.arc(x, y-10, 12, 0, Math.PI*2); c.closePath(); c.clip();
        if(faceLoaded){ c.drawImage(FALEIRO_FACE, x-12, y-22, 24, 24); }
        else { c.fillStyle='#d2f5ff'; c.fillRect(x-12, y-22, 24, 24); }
        c.restore();
        c.fillStyle='#0b0f14'; c.fillRect(x-12, y-2, 24, 3);
        c.fillStyle='#9ec9ff'; c.fillRect(x-16, y+8, 32, 26);
      }, projectile:'brain' },
    xadao:{ name:'Xad√£o Pediatr√£o', color:'#ff9e64', shotColor:'#ffd1b0',
      draw:(x,y)=>{ c.fillStyle='#d0ffcf'; c.fillRect(x-13,y-24,26,26); c.fillStyle:'#0b0f14'; c.fillRect(x-16,y+2,32,4); c.fillStyle:'#6f8a9b'; c.fillRect(x-18,y+8,36,28); c.fillStyle:'#b5ecff'; c.fillRect(x+14,y,16,6); c.fillStyle:'#79d4ff'; c.fillRect(x+28,y+1,8,4); }, projectile:'syringe' }
  };

  const player = { x: canvas.width/2, y: canvas.height-70, w:26, h:32, speed: 420 };

  function resetGame(){
    state.score=0; state.level=1; state.lives=3;
    state.bullets.length=0; state.enemies.length=0; state.particles.length=0; state.enemyBullets.length=0;
    player.x=canvas.width/2; state.over=false; state.paused=false; state.running=true;
    state.lastSpawn=0; state.spawnInterval=1400; state.lastShot=0; state.shotInterval=220;
  }

  function spawnEnemy(){
    const e = { x: rand(40, canvas.width-40), y: -30, w:24, h:24, vy: rand(60,120)+state.level*8,
      vx: rand(-40,40), hp: 1+Math.floor(state.level/4), score: 10+state.level*2, t: performance.now(),
      shootable: Math.random()< (0.15 + state.level*0.01) };
    state.enemies.push(e);
  }

  function shoot(){
    const now = performance.now();
    if(now-state.lastShot < state.shotInterval) return;
    state.lastShot=now;
    const b = { x: player.x, y: player.y-20, r: 5, vy: -560, type: state.hero.projectile };
    state.bullets.push(b);
    AudioSys.beep(state.hero.projectile==='brain'? 520:420, 0.06, 'square', 0.03);
  }

  function enemyShoot(e){
    const b={ x:e.x, y:e.y+8, r:4, vy: 220+state.level*12 };
    state.enemyBullets.push(b);
    AudioSys.beep(200,0.05,'sawtooth',0.02);
  }

  function explode(x,y,color){
    for(let i=0;i<14;i++){
      state.particles.push({x,y, vx:rand(-120,120), vy:rand(-160,0), life: 300+Math.random()*400, color});
    }
  }

  // ===== Loop principal =====
  let last=performance.now();
  function loop(now){
    const dt = (now-last)/1000; last=now;
    if(!state.running||state.paused){ requestAnimationFrame(loop); return draw(); }

    state.spawnInterval = Math.max(450, 1400 - state.level*40 - state.score*0.4);

    const dir = (state.keys.left?-1:0) + (state.keys.right?1:0);
    player.x = Math.max(24, Math.min(player.x + dir * player.speed * dt, canvas.width-24));
    if(state.keys.fire) shoot();

    state.lastSpawn += dt*1000;
    if(state.lastSpawn>=state.spawnInterval){ state.lastSpawn=0; spawnEnemy(); }

    state.bullets.forEach(b=> b.y += b.vy*dt);
    state.bullets = state.bullets.filter(b=> b.y>-20);

    state.enemies.forEach(e=>{
      e.y += e.vy*dt; e.x += e.vx*dt; if(e.x<20||e.x>canvas.width-20) e.vx*=-1;
      if(e.shootable && now-e.t>700){ if(Math.random()<0.015+state.level*0.003) {e.t=now; enemyShoot(e);} }
    });

    state.enemyBullets.forEach(b=> b.y += b.vy*dt);

    for(let i=state.enemies.length-1;i>=0;i--){
      const e=state.enemies[i];
      for(let j=state.bullets.length-1;j>=0;j--){
        const b=state.bullets[j];
        if(Math.abs(e.x-b.x)<(e.w/2 + b.r) && Math.abs(e.y-b.y)<(e.h/2 + b.r)){
          state.bullets.splice(j,1);
          e.hp--; explode(b.x,b.y, HEROES[state.heroKey].shotColor);
          if(e.hp<=0){
            explode(e.x,e.y, '#ffd16b');
            state.score += e.score; state.enemies.splice(i,1);
            if(state.score % 120 === 0){ state.level++; AudioSys.beep(880,0.08,'triangle',0.04); }
          } else { AudioSys.beep(300,0.04,'triangle',0.02); }
          break;
        }
      }
    }

    let hit = state.enemies.find(e=> Math.abs(e.x-player.x)<(e.w/2 + player.w/2) && Math.abs(e.y-player.y)<(e.h/2 + player.h/2));
    if(hit){ damage(); state.enemies.splice(state.enemies.indexOf(hit),1); }
    for(let k=state.enemyBullets.length-1;k>=0;k--){
      const b=state.enemyBullets[k];
      if(Math.abs(b.x-player.x)<(player.w/2 + b.r) && Math.abs(b.y-player.y)<(player.h/2 + b.r)){
        state.enemyBullets.splice(k,1); damage(); break;
      }
    }

    state.enemies = state.enemies.filter(e=> e.y < canvas.height + 50);
    state.enemyBullets = state.enemyBullets.filter(b=> b.y < canvas.height + 20);

    state.particles.forEach(p=>{ p.x+=p.vx*dt; p.y+=p.vy*dt; p.vy+=380*dt; p.life-=dt*1000; });
    state.particles = state.particles.filter(p=> p.life>0);

    draw();
    requestAnimationFrame(loop);
  }

  function damage(){
    explode(player.x, player.y, '#ff6b6b');
    AudioSys.beep(110,0.12,'sawtooth',0.06);
    state.lives--; updateHUD();
    if(state.lives<=0){ gameOver(); }
  }

  function gameOver(){
    state.over=true; state.running=false;
    document.getElementById('finalScore').textContent = `Pontua√ß√£o: ${state.score}`;
    document.getElementById('gameOverOverlay').style.display='flex';
  }

  function draw(){
    c.fillStyle='#000'; c.fillRect(0,0,canvas.width,canvas.height);
    for(let i=0;i<40;i++){
      c.fillStyle = `rgba(255,255,255,${0.05+((i%7)/20)})`;
      c.fillRect((i*97)%canvas.width, (i*53 + (performance.now()/40))%canvas.height, 2, 2);
    }

    if(!state.over){
      HEROES[state.heroKey]?.draw(player.x, player.y);
      c.fillStyle = HEROES[state.heroKey]?.color || '#7ee787';
      c.fillRect(player.x-14, player.y+40, 28, 5);
    }

    state.bullets.forEach(b=>{
      if(state.hero?.projectile==='brain'){
        c.beginPath(); c.arc(b.x,b.y,6,0,Math.PI*2); c.fillStyle='#aaf0a5'; c.fill();
        c.fillStyle='#0b0f14'; c.fillRect(b.x-2,b.y-2,4,4);
      } else {
        c.fillStyle='#ffd1b0'; c.fillRect(b.x-2,b.y-8,4,16);
        c.fillStyle='#79d4ff'; c.fillRect(b.x-2,b.y-12,4,4);
      }
    });

    state.enemies.forEach(e=>{
      c.fillStyle='#ffcf6b'; c.fillRect(e.x-12,e.y-12,24,24);
      c.fillStyle='#2b2b2b'; c.fillRect(e.x-10,e.y-16,20,6);
    });

    state.enemyBullets.forEach(b=>{ c.fillStyle='#ff6b6b'; c.fillRect(b.x-2,b.y-6,4,12); });

    state.particles.forEach(p=>{ c.fillStyle=p.color; c.fillRect(p.x,p.y,2,2); });
  }

  function updateHUD(){
    document.getElementById('hudLives').textContent = state.lives;
    document.getElementById('hudScore').textContent = state.score;
    document.getElementById('hudLevel').textContent = state.level;
  }

  const startOverlay = document.getElementById('startOverlay');
  const pauseOverlay = document.getElementById('pauseOverlay');

  function startWith(heroKey){
    state.heroKey = heroKey;
    state.hero = HEROES[heroKey];
    document.getElementById('hudHero').textContent = `Her√≥i: ${state.hero.name}`;
    startOverlay.style.display='none';
    resetGame();
    if(AudioSys.ctx.state==='suspended'){ AudioSys.ctx.resume(); }
  }

  document.querySelectorAll('.choice').forEach(el=> el.addEventListener('click', ()=> startWith(el.dataset.hero)) );
  document.getElementById('btnAgain').addEventListener('click', ()=>{ document.getElementById('gameOverOverlay').style.display='none'; startOverlay.style.display='flex'; });
  document.getElementById('btnReset').addEventListener('click', ()=>{ startOverlay.style.display='flex'; state.running=false; });

  window.addEventListener('keydown', (e)=>{
    if(e.repeat) return;
    if(e.code==='ArrowLeft' || e.code==='KeyA') state.keys.left=true;
    if(e.code==='ArrowRight' || e.code==='KeyD') state.keys.right=true;
    if(e.code==='Space'){ state.keys.fire=true; e.preventDefault(); }
    if(e.code==='KeyP'){ togglePause(); }
  });
  window.addEventListener('keyup', (e)=>{
    if(e.code==='ArrowLeft' || e.code==='KeyA') state.keys.left=false;
    if(e.code==='ArrowRight' || e.code==='KeyD') state.keys.right=false;
    if(e.code==='Space') state.keys.fire=false;
  });

  function togglePause(){ if(!state.running) return; state.paused = !state.paused; pauseOverlay.style.display = state.paused? 'flex':'none'; }

  requestAnimationFrame(loop);
  updateHUD();
  </script>
</body>
</html>
